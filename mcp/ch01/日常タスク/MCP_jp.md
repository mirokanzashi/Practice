# MCPによるコード実行：より効率的なagentの構築
Model Context Protocol（MCP）は、AIagentを外部システムに接続するためのオープン標準です。agentをツールやデータに接続するには、従来、各ペアリングに対してカスタム統合が必要であり、断片化と重複作業が生じ、真に接続されたシステムのスケールが困難でした。MCPは普遍的なprotocolを提供します。開発者はagentにMCPを一度実装するだけで、統合のエコシステム全体が利用可能になります。

2024年11月にMCPをローンチして以来、採用は急速に進んでいます。コミュニティは数千のMCP serverを構築し、すべての主要なプログラミング言語でSDKが利用可能になり、業界はagentをツールやデータに接続するための事実上の標準としてMCPを採用しています。

## ツールによる過剰なtoken消費がagentの効率を低下させる
MCPの使用規模が拡大するにつれて、agentのコストとレイテンシを増加させる2つの一般的なパターンがあります：

1. ツール定義がcontext windowに過負荷をかける
2. 中間ツール結果が追加のtokenを消費する

### 1. ツール定義がcontext windowに過負荷をかける
ほとんどのMCP clientは、すべてのツール定義を事前にcontextに直接読み込み、直接的なツール呼び出し構文を使用してmodelに公開します。

### 2. 中間ツール結果が追加のtokenを消費する
ほとんどのMCP clientは、modelがMCPツールを直接呼び出すことを許可しています。例えば、agentに次のように尋ねることができます：「Google Driveから会議のトランスクリプトをダウンロードして、Salesforceのリードに添付してください。」

## MCPによるコード実行がcontextの効率を向上させる
agentのコード実行環境がより一般的になってきたことで、MCP serverを直接的なツール呼び出しではなく、コードAPIとして提示するソリューションが登場しました。agentはMCP serverと対話するコードを書くことができます。このアプローチは両方の課題に対処します：agentは必要なツールのみを読み込み、結果をmodelに戻す前に実行環境でデータを処理できます。

## MCPによるコード実行の利点
MCPによるコード実行により、agentはツールをオンデマンドで読み込み、データがmodelに到達する前にフィルタリングし、単一ステップで複雑なロジックを実行することで、contextをより効率的に使用できます。このアプローチを使用することには、セキュリティと状態管理の利点もあります。

### プログレッシブディスクロージャー
Modelはファイルシステムのナビゲートに優れています。ツールをファイルシステム上のコードとして提示することで、modelはすべてを事前に読み込むのではなく、ツール定義をオンデマンドで読み取ることができます。

### Context効率的なツール結果
大規模なデータセットを扱う場合、agentはコード内で結果をフィルタリングおよび変換してから返すことができます。

### プライバシーを保護する操作
agentがMCPによるコード実行を使用する場合、中間結果はデフォルトで実行環境内に留まります。これにより、agentは明示的にログまたは返すものだけを見ることができ、modelと共有したくないデータは、modelのcontextに入ることなくワークフローを通過できます。

### 状態の永続化とスキル
ファイルシステムアクセスを備えたコード実行により、agentは操作間で状態を維持できます。agentは中間結果をファイルに書き込むことができ、作業を再開し、進捗を追跡できます。

## まとめ
MCPは、agentが多くのツールやシステムに接続するための基盤となるprotocolを提供します。しかし、あまりにも多くのserverが接続されると、ツール定義と結果が過剰なtokenを消費し、agentの効率が低下します。